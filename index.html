<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asura Premium Cracked</title>
    <link rel="shortcut icon" href="favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        .chapter-link:hover {
            text-decoration: underline;
        }

        .card {
            --background: linear-gradient(to right, #13b37f 0%, #11a3c8 100%);
            width: 140px;
            height: 180px;
            padding: 0.9px;
            border-radius: 0.7rem;
            overflow: visible;
            background: #f7ba2b;
            background: var(--background);
            position: relative;
            z-index: 1;
        }

        .card::after {
            position: absolute;
            content: "";
            top: -22px;
            left: 0px;
            right: 0;
            z-index: -1;
            height: 100%;
            width: 100%;
            transform: scale(0.76);
            filter: blur(34.5px);
            background: #f7ba2b;
            background: var(--background);
            transition: opacity 0.5s;
        }

        .card-info {
            --color: #1f1a1d;
            background: var(--color);
            color: var(--color);
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            overflow: visible;
            border-radius: 0.7rem;
        }

        .card .title {
            font-weight: light;
            letter-spacing: 0.2em;
        }

        /* Hover */
        .card:hover::after {
            opacity: 0.6;
            padding: 0.7rem 0;
            top: 18px;
            transition: 0.6s;
        }

        .card:hover .card-info {
            color: #fff9f9;
            transition: color 1s;
        }
        .custom-bg {
            background-color: #1b1a1b;
            background-image: url("data:image/svg+xml,%3Csvg width='42' height='44' viewBox='0 0 42 44' xmlns='http://www.w3.org/2000/svg'%3E%3Cg id='Page-1' fill='none' fill-rule='evenodd'%3E%3Cg id='brick-wall' fill='%23f0edf6' fill-opacity='0.16'%3E%3Cpath d='M0 0h42v44H0V0zm1 1h40v20H1V1zM0 23h20v20H0V23zm22 0h20v20H22V23z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            background-size: 42px 44px;
            background-repeat: repeat;
       }


    </style>
</head>
<body class="custom-bg test-white">
    <div class="container mx-auto p-4">
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-center mb-2">Bypass Asura</h1>
            <p class="text-gray-400 text-center">Made by l3v2s on discord</p>
        </header>

        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold">Latest Chapters</h2>
            <div class="flex space-x-4">
                <select id="seriesFilter" class="bg-gray-800 text-white px-4 py-2 rounded">
                    <option value="all">All Series</option>
                </select>
                <button id="refreshButton" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded flex items-center">
                    <i class="fas fa-sync-alt mr-2"></i> Refresh
                </button>
            </div>
        </div>

        <div id="mangaGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Manga items will be populated here by JavaScript -->
        </div>
    </div>

<script>
    // Function to load the state.json file and display manga
    async function loadMangaList() {
        try {
            const response = await fetch("state.json");
            if (!response.ok) {
                throw new Error('Failed to load manga data(status: ' + response.status + ')');
            }
            
            const data = await response.json();
            const downloadedChapters = data.downloadedChapters || {};
            
            // Process the data
            const seriesMap = {};
            
            // Group chapters by series
            Object.entries(downloadedChapters).forEach(([key, chapter]) => {
                // Skip invalid entries
                if (!chapter || typeof chapter !== 'object') {
                    console.warn(`Skipping invalid chapter entry for key: ${key}`);
                    return;
                }
                
                const [seriesName, chapterNumber] = key.split('_');
                
                // Check if chapter has a valid timestamp
                const timestamp = chapter.timestamp ? new Date(chapter.timestamp) : new Date();
                
                if (!seriesMap[seriesName]) {
                    seriesMap[seriesName] = [];
                }
                
                seriesMap[seriesName].push({
                    chapterNumber,
                    timestamp,
                    formattedTime: getTimeAgo(timestamp),
                    githubPath: chapter.githubPath || '',
                    imageCount: chapter.imageCount || 0
                });
            });
            
            // Sort chapters within each series by chapter number (newest first)
            Object.values(seriesMap).forEach(chapters => {
                chapters.sort((a, b) => {
                    // Try to compare as numbers if possible
                    const numA = parseInt(a.chapterNumber);
                    const numB = parseInt(b.chapterNumber);
                    
                    if (!isNaN(numA) && !isNaN(numB)) {
                        return numB - numA; // Descending order
                    }
                    
                    // Fall back to string comparison
                    return b.chapterNumber.localeCompare(a.chapterNumber);
                });
            });
            
            // Sort series by most recent chapter
            const sortedSeries = Object.entries(seriesMap).sort((a, b) => {
                const latestA = a[1][0].timestamp;
                const latestB = b[1][0].timestamp;
                return latestB - latestA;
            });
            
            // Populate the filter dropdown
            const filterSelect = document.getElementById('seriesFilter');
            filterSelect.innerHTML = '<option value="all">All Series</option>';
            
            sortedSeries.forEach(([seriesName]) => {
                const formattedName = formatSeriesName(seriesName);
                const option = document.createElement('option');
                option.value = seriesName;
                option.textContent = formattedName;
                filterSelect.appendChild(option);
            });
            
            // Display the manga
            displayManga(sortedSeries);
            
            // Set up event listeners
            filterSelect.addEventListener('change', () => {
                const selectedSeries = filterSelect.value;
                if (selectedSeries === 'all') {
                    displayManga(sortedSeries);
                } else {
                    const filtered = sortedSeries.filter(([series]) => series === selectedSeries);
                    displayManga(filtered);
                }
            });
            
            document.getElementById('refreshButton').addEventListener('click', () => {
                loadMangaList();
            });
            
        } catch (error) {
            console.error('Error loading manga list:', error);
            document.getElementById('mangaGrid').innerHTML = `
                <div class="col-span-full text-center p-8 bg-red-900 bg-opacity-30 rounded">
                    <p class="text-xl">Failed to load manga data. Please check that state.json exists.</p>
                    <p class="mt-2 text-gray-400">${error.message}</p>
                    <button id="retryButton" class="mt-4 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded">
                        Retry Loading
                    </button>   
                </div>
            `;

            // retry button 
            document.getElementById('retryButton').addEventListener('click', () => {
                loadMangaList();
            });
        }
    }

    // Function to display manga in the grid
    function displayManga(seriesList) {
        const mangaGrid = document.getElementById('mangaGrid');
        mangaGrid.innerHTML = '';
        
        if (seriesList.length === 0) {
            mangaGrid.innerHTML = `
                <div class="col-span-full text-center p-8 bg-gray-800 rounded">
                    <p class="text-xl">No manga chapters found.</p>
                </div>
            `;
            return;
        }
        
        seriesList.forEach(([seriesName, chapters]) => {
            const formattedName = formatSeriesName(seriesName);
            const seriesDiv = document.createElement('div');
            seriesDiv.className = 'bg-gray-800 rounded-lg p-4 flex space-x-4';
            
            // Create the card with a default symbol instead of a cover image
            const card = document.createElement('div');
            card.className = 'card';
            
            const cardInfo = document.createElement('div');
            cardInfo.className = 'card-info';
            // Keep it empty and black as requested
            card.appendChild(cardInfo);
            
            // Create content div
            const contentDiv = document.createElement('div');
            contentDiv.className = 'flex-1';
            
            // Create series title
            const title = document.createElement('h2');
            title.className = 'text-lg font-bold mb-2 text-purple-300';
            title.textContent = formattedName;
            
            // Create chapter list
            const chapterList = document.createElement('ul');
            chapterList.className = 'text-sm space-y-2';
            
            // Only show up to 3 most recent chapters
            chapters.slice(0, 7).forEach(chapter => {
                const chapterItem = document.createElement('li');
                chapterItem.className = 'flex items-center justify-between';
                
                // Create the link using the githubPath
                const chapterLink = chapter.githubPath ? 
                    `/${chapter.githubPath}` : 
                    '#'; // Fallback link if no githubPath
                
                chapterItem.innerHTML = `
                    <a href="${chapterLink}" class="text-purple-500 hover:text-purple-400 chapter-link">
                        • Chapter ${chapter.chapterNumber}
                    </a>
                    <span class="text-gray-400">${chapter.formattedTime}</span>
                `;
                
                chapterList.appendChild(chapterItem);
            });
            
            // Assemble the manga item
            contentDiv.appendChild(title);
            contentDiv.appendChild(chapterList);
            
            seriesDiv.appendChild(card);
            seriesDiv.appendChild(contentDiv);
            
            mangaGrid.appendChild(seriesDiv);
        });
    }
    
    // Helper function to format series name (convert from snake_case to Title Case)
    function formatSeriesName(seriesName) {
        if (seriesName === 'Unknown Series') return seriesName;
        
        return seriesName
            .split('_')
            .map(word => word.charAt(0).toUpperCase() + word.slice(1))
            .join(' ');
    }
    
    // Helper function to format timestamps as "X time ago"
    function getTimeAgo(timestamp) {
        const now = new Date();
        const diff = now - timestamp;
        
        const minutes = Math.floor(diff / 60000);
        const hours = Math.floor(minutes / 60);
        const days = Math.floor(hours / 24);
        
        if (days > 0) {
            return `${days} day${days > 1 ? 's' : ''} ago`;
        } else if (hours > 0) {
            return `${hours} hour${hours > 1 ? 's' : ''} ago`;
        } else if (minutes > 0) {
            return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;
        } else {
            return 'just now';
        }
    }
    
    // Load manga list when the page loads
    document.addEventListener('DOMContentLoaded', loadMangaList);
</script>

<script>
    document.body.style.zoom = "90%";
</script>
    
</body>
</html>
